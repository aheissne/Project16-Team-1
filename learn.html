<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scaffwording - Learn Words</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; }
    .header { margin-top: 20px; padding: 0 16px; display:flex; justify-content:space-between; align-items:center; }
    .header a { text-decoration:none; }
    .logout { padding: 5px 10px; background: #1a73e8; color:white; text-decoration: none; border-radius:5px; }
    .content { margin-top: 100px; display:flex; flex-direction:column; align-items:center; }
    select { padding:10px; font-size:1em; border-radius:5px; border:1px solid #ccc; margin-top:20px; width:200px; }
    button.primary { padding:10px 20px; margin-top:20px; border:none; border-radius:5px; background:#1a73e8; color:#fff; cursor:pointer; width:200px; }
    .back-link { margin-top:20px; color:#1a73e8; text-decoration:none; }
    .footer { margin-top:40px; color:#667; font-size:0.8em; }
    .logo {
	        height: 80px; 
	        vertical-align: middle;
          margin-right: 100px;
	      }
        /* === Beautiful XP Bar === */
        .xp-progress{
            height:10px;
            background:#e0e0e0;
            border-radius:6px;
            overflow:hidden;
            margin-top:2px;
            box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .xp-fill{
            height:100%;
            background:linear-gradient(to right,#34a853,#5dd46c);
            width:0%;
            border-radius:6px;
            transition:width 0.8s ease-out;
            box-shadow:0 2px 4px rgba(52,168,83,0.3);
        }
  </style>
</head>
<body>
  <div class="header">
    <div class="xp-bar" id="xpDisplay" style="margin: 20px 0; font-weight: bold; color: #1a73e8; display: inline-block;">
        Loading XP...
        </div>
    <a href="welcome.html">
	    <img src="assets/gifs/scafwording.jpg" alt="Scafwording Logo" class="logo">
	</a>
    <a href="index.html" class="logout">Log out</a>
  </div>

  <div class="content">
    <h2>How many words to study?</h2>
    <select id="countSelect">
      <option value="5">5 Words</option>
      <option value="10">10 Words</option>
      <option value="15">15 Words</option>
      <option value="20">20 Words</option>
    </select>
    <button class="primary" id="startBtn">Start Learning</button>
    <a href="welcome.html" class="back-link">Back to Dashboard</a>
  </div>

  <div class="footer">
    <div>Contact Support: <a href="mailto:support@scaffwording.app">support@scaffwording.app</a></div>
    <div>Â©2024 Scaffwording. All Rights Reserved</div>
  </div>

<script>
  async function loadWords() {
    try {
      const r = await fetch('words.json');
      return await r.json();
    } catch {
      return {};
    }
  }

  document.getElementById('startBtn').addEventListener('click', async () => {
    const WORDS = await loadWords();
    const allIds = Object.keys(WORDS).map(Number).filter(Number.isInteger).sort((a,b)=>a-b);

    const requested = Number(document.getElementById('countSelect').value) || 5;
    const available = allIds.length;
    const clamped = available ? Math.min(requested, available) : requested;

    // âœ… Clear any old stored selections before saving new ones
    localStorage.removeItem('selectedWordIds');
    localStorage.removeItem('maxQuestions');
    localStorage.removeItem('quizScore');
    localStorage.removeItem('incorrectWords')
    localStorage.removeItem('attemptsMap');  

    // âœ… If words.json failed or is empty, synthesize 1..N so we don't save [].
    const selected = available
      ? allIds.slice(0, clamped)
      : Array.from({ length: clamped }, (_, i) => i + 1);

    // âœ… Save the new session
    localStorage.setItem('selectedWordIds', JSON.stringify(selected));
    localStorage.setItem('maxQuestions', String(clamped));
    localStorage.setItem('quizScore', '0');
    localStorage.setItem('incorrectWords', JSON.stringify([]));

    // Go to the quiz
    // ðŸ•’ Small delay to ensure Safari saves localStorage before navigating
setTimeout(() => {
  window.location.href = 'learn-quiz.html?index=0';
}, 150);

  });
</script>
<script src="xp.js"></script>
<script>
window.addEventListener('load', () => {
    const xpContainer = document.getElementById('xpDisplay');

    // 1. Let xp.js write the level + XP text
    renderXP('xpDisplay');

    // 2. Now inject the beautiful progress bar (it won't be overwritten anymore)
    if (!document.querySelector('.xp-progress')) {
        xpContainer.insertAdjacentHTML('beforeend', `
            <div class="xp-progress">
                <div class="xp-fill"></div>
            </div>
        `);
    }

    // 3. Finally fill the green bar
    if (typeof getXP === 'function' && typeof XP_PER_LEVEL === 'number') {
        const progress = (getXP() % XP_PER_LEVEL) / XP_PER_LEVEL * 100;
        const fill = document.querySelector('.xp-fill');
        if (fill) fill.style.width = progress + '%';
    }
});
</script>
</body>
</html>
