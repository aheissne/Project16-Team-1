<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scafwording - Welcome Ethan</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        .header {
            margin-top: 5px; padding: 0 16px; display:flex; justify-content:space-between; align-items:center;
        }
	      .logo {
	        height: 80px; 
	        vertical-align: middle;
          margin-right: 125px;
	      }

        .welcome {
            margin-top: 25px;
        }
        .progress {
	          margin-top: 45px;
            display: flex;
            justify-content: center;
            gap: 150px;
        }
        .progress-circle {
            width: 100px;
            height: 100px;
            background: conic-gradient(#34a853 14%, #e0e0e0 0deg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .progress-circle:nth-child(2) {
	        background: conic-gradient(#34a853 100%, #e0e0e0 0deg);
        }

        .buttons {
          margin: 20px 0;
	        display: flex;
	        justify-content: center;
	        gap: 70px;
        }
        button {
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 5px;
            background-color: #1a73e8;
            color: white;
            cursor: pointer;
        }
	.learned-words-btn {
	    background-color: #fbbc04; 
	    color: black;
}

	.feedback-button {
	    background-color: #000080 !important;
	    color: white;
	}
        .feedback {
            margin: 40px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        .footer {
            margin-top: 40px;
            color: #666;
            font-size: 0.8em;
        }

/* === Beautiful XP Bar === */
        .xp-progress{
            height:10px;
            background:#e0e0e0;
            border-radius:6px;
            overflow:hidden;
            margin-top:2px;
            box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .xp-fill{
            height:100%;
            background:linear-gradient(to right,#34a853,#5dd46c);
            width:0%;
            border-radius:6px;
            transition:width 0.8s ease-out;
            box-shadow:0 2px 4px rgba(52,168,83,0.3);
        }
    </style>
</head>
<body>
    <div class="header">
      <div class="xp-bar" id="xpDisplay" style="margin: 10px ; font-weight: bold; color: #1a73e8; display: inline-block;">
        Loading XP...
    </div>
        <a href="index.html">
	    <img src="assets/gifs/scafwording.jpg" alt="Scafwording Logo" class="logo">
	</a>
        <a href="index.html" style="float: right; padding: 5px 10px; background-color: #1a73e8; color: white; text-decoration: none; border-radius: 5px;">Log out</a>
    </div>
    <div class="welcome">
        <h2>Welcome Ethan</h2>
<div id="streak-container" style="margin: 30px auto; max-width: 360px; text-align: center; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
  <!-- Flame + Number -->
  <div style="position: relative; display: inline-block; margin-bottom: 8px;">
    <svg width="120" height="140" viewBox="0 0 120 140" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M60 10 C30 50, 20 80, 60 130 C100 80, 90 50, 60 10" fill="#FF9C1A"/>
      <path d="M60 20 C40 50, 35 70, 60 110 C85 70, 80 50, 60 20" fill="#FFC350"/>
      <path d="M60 35 C48 55, 45 70, 60 100" fill="#FF9C1A"/>
    </svg>
    <div id="streak-number" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 58px; font-weight: 900; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
      0
    </div>
  </div>

  <p style="color: #FF6B35; font-weight: bold; font-size: 20px; margin: 8px 0 20px;">
    day streak!
  </p>

  <!-- 7-Day Week Bar -->
  <div style="background: #f8f9fa; border-radius: 16px; padding: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
    <div style="display: flex; justify-content: space-between; font-size: 13px; color: #666; margin-bottom: 10px;">
      <span>M</span><span>Tu</span><span>W</span><span>Thu</span><span>F</span><span>Sa</span><span>Su</span>
    </div>
    <div id="week-circles" style="display: flex; justify-content: space-between; gap: 8px;">
      <!-- 7 circles will be filled by JS -->
    </div>

    <p style="margin: 16px 0 0; font-size: 14px; color: #555; line-height: 1.4;">
      A streak counts how many days<br>you've practiced in a row
    </p>
  </div>
</div>
        <div class="progress">
            <div class="progress-circle"></div>
            <div class="progress-circle"></div>
        </div>
        <div class="buttons">
            <a href="learn.html"><button>Learn more words</button></a>
            <a href="quiz.html"><button>Start a Daily Quiz</button></a>
        </div>
        <a href="learned-words.html"><button class="learned-words-btn">View Learned Words</button></a>
    </div>
    <div class="feedback">
        <p>Rate Your Learning Journey</p>
        <button class="feedback-button">Share Feedback</button>
    </div>
    <div class="footer">
        <div>Contact Support: <a href="mailto:support@scafwording.app">support@scafwording.app</a></div>
        <div>©2024 Scafwording. All Rights Reserved</div>
    </div>
<script src="xp.js"></script>
<script>
window.addEventListener('load', () => {
    const xpContainer = document.getElementById('xpDisplay');

    // 1. Let xp.js write the level + XP text
    renderXP('xpDisplay');

    // 2. Now inject the beautiful progress bar (it won't be overwritten anymore)
    if (!document.querySelector('.xp-progress')) {
        xpContainer.insertAdjacentHTML('beforeend', `
            <div class="xp-progress">
                <div class="xp-fill"></div>
            </div>
        `);
    }

    // 3. Finally fill the green bar
    if (typeof getXP === 'function' && typeof XP_PER_LEVEL === 'number') {
        const progress = (getXP() % XP_PER_LEVEL) / XP_PER_LEVEL * 100;
        const fill = document.querySelector('.xp-fill');
        if (fill) fill.style.width = progress + '%';
    }
});
</script>
<script>
(async () => {
  // 1) Load dictionary size for totals
  const WORDS = await fetch('words.json').then(r => r.json()).catch(()=> ({}));
  const TOTAL_DICT = Object.keys(WORDS).length || 10; // fallback

  // 2) Username + greeting
  const name = localStorage.getItem('username') || 'there';
  document.title = 'Scaffwording - Welcome ' + name; // fix spelling in title
  const h2 = document.querySelector('.welcome h2');
  if (h2) h2.textContent = `Welcome ${name}`;

  // 3) Learned words progress
  const learned = JSON.parse(localStorage.getItem('learnedWords') || '[]');
  const learnedCount = learned.length;
  const learnedPct = Math.max(0, Math.min(100, (learnedCount / TOTAL_DICT) * 100));

  // 4) Retention = last quiz score / maxQuestions
  const score = Number(localStorage.getItem('quizScore') || '0');
  const selected = JSON.parse(localStorage.getItem('selectedWordIds') || '[]');
  const maxQ = Number(localStorage.getItem('maxQuestions')) || (selected.length || 5);
  const retentionPct = maxQ ? Math.max(0, Math.min(100, (score / maxQ) * 100)) : 0;

  // 5) Paint the two progress rings and labels
  const rings = document.querySelectorAll('.progress-circle');
  if (rings[0]) {
    rings[0].style.background = `conic-gradient(#34a853 ${learnedPct * 3.6}deg, #e0e0e0 0deg)`;
    rings[0].setAttribute('aria-label', `${learnedCount} of ${TOTAL_DICT} words learned`);
    rings[0].style.position = 'relative';
    rings[0].innerHTML = `<div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#000;font-size:.76em;padding:8px;text-align:center;">
      ${learnedCount} of ${TOTAL_DICT} Words Learned
    </div>`;
  }
  if (rings[1]) {
    rings[1].style.background = `conic-gradient(#34a853 ${retentionPct * 3.6}deg, #e0e0e0 0deg)`;
    rings[1].setAttribute('aria-label', `${retentionPct.toFixed(0)}% retention`);
    rings[1].style.position = 'relative';
    rings[1].innerHTML = `<div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#000;font-size:.9em;padding:8px;text-align:center;">
      ${retentionPct.toFixed(0)}% Retention
    </div>`;
  }

  // 6) Make the two CTA buttons set up a 10-word session by default
  function setSelection(n = 10) {
    // If you later add a picker, write those IDs here instead of 1..n
    const ids = Array.from({length: Math.min(n, TOTAL_DICT)}, (_, i) => i + 1);
    localStorage.setItem('selectedWordIds', JSON.stringify(ids));
    localStorage.setItem('maxQuestions', String(ids.length));
  }

  // Replace anchor+button nesting with click handlers on anchors
  const learnLink = document.querySelector('a[href="learn.html"]');
  const quizLink  = document.querySelector('a[href="quiz.html"]');

  if (learnLink) {
    learnLink.addEventListener('click', (e) => {
      setSelection(10);             // default to 10
      // optionally start at first learn card
      // window.location.href = 'learn-quiz.html?index=0'; return e.preventDefault();
    });
  }
  if (quizLink) {
    quizLink.addEventListener('click', (e) => {
      setSelection(10);             // default to 10
      // quiz.html will read maxQuestions/selectedWordIds and route to quiz-questions
    });
  }

})();

function updateStreakBox() {
  let now = new Date();
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

  let streak = parseInt(localStorage.getItem('loginStreak') || '0');
  const lastLoginStr = localStorage.getItem('lastLoginDate');
  const lastLogin = lastLoginStr ? new Date(lastLoginStr) : null;

  // Calculate streak
  if (!lastLogin) {
    streak = 1;
  } else {
    const daysDiff = Math.floor((today - lastLogin) / (1000 * 60 * 60 * 24));
    if (daysDiff === 0) {
      // already logged in today
    } else if (daysDiff === 1) {
      streak += 1;
    } else {
      streak = 1; // reset
    }
  }

  // Save login
  localStorage.setItem('lastLoginDate', today.toISOString());
  localStorage.setItem('loginStreak', streak);

  // Update big number
  document.getElementById('streak-number').textContent = streak;

  // Render 7-day circles (Monday first → Sunday last)
  const weekContainer = document.getElementById('week-circles');
  weekContainer.innerHTML = '';

  const dayOffset = now.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
  const offsetsFromMonday = [0, 1, 2, 3, 4, 5, 6]; // M Tu W Th F Sa Su

  offsetsFromMonday.forEach((offset, index) => {
    const checkDate = new Date(today);
    const daysBack = (dayOffset + 6 - index) % 7; // magic: maps today correctly
    checkDate.setDate(today.getDate() - daysBack);

    const wasActive = streak > daysBack; // last `streak` days are active

    const circle = document.createElement('div');
    circle.style.width = '36px';
    circle.style.height = '36px';
    circle.style.borderRadius = '50%';
    circle.style.background = wasActive ? '#FF9925' : '#E5E5E5';
    circle.style.display = 'flex';
    circle.style.alignItems = 'center';
    circle.style.justifyContent = 'center';
    circle.style.fontSize = '20px';
    circle.style.color = 'white';
    circle.style.fontWeight = 'bold';
    circle.textContent = wasActive ? '✓' : '';

    // Highlight today
    if (daysBack === 0) {
      circle.style.boxShadow = wasActive ? '0 0 0 4px #FFE0B2' : '0 0 0 4px #E0E0E0';
      circle.style.transform = 'scale(1.1)';
    }

    weekContainer.appendChild(circle);
  });


}

// Run on page load
updateStreakBox();
</script>
</body>
</html>
