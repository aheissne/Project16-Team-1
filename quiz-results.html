<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scaffwording - Quiz Results</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background-color: #4a4a4a;
      display: flex; justify-content: center; align-items: center;
      min-height: 100vh;
    }
    .results-container {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      width: 400px;
    }
    .title {
      color: #1a73e8;
      font-size: 1.8em;
      margin-bottom: 20px;
    }
    .tabs {
      display: flex; justify-content: center; margin-bottom: 20px;
    }
    .tab-button {
      padding: 10px 20px; margin: 0 5px;
      border: none; border-radius: 5px 5px 0 0;
      background-color: #e0e0e0; cursor: pointer;
      font-size: 1em; color: #333;
    }
    .tab-button.active { background-color: #1a73e8; color: #fff; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .summary { margin-bottom: 20px; }
    .score { color: #000; font-size: 1.4em; margin-bottom: 6px; }
    .percentage { color: #666; font-size: 1em; }

    .word-list { text-align: left; margin-bottom: 20px; }
    .word-item {
      display: flex; justify-content: space-between; gap: 8px;
      padding: 8px 0; border-bottom: 1px solid #e0e0e0;
    }
    .word { color: #000; }
    .status { font-weight: bold; }
    .status.correct { color: #34a853; }
    .status.incorrect { color: #ea4335; }

    .buttons button {
      padding: 12px 25px; margin: 0 10px;
      border: none; border-radius: 5px;
      background-color: #1a73e8; color: #fff; cursor: pointer; font-size: 1em;
    }
    .buttons button:hover { background-color: #1557a0; }

    .footer {
      margin-top: 20px; color: #ddd; font-size: 0.8em; text-align: center;
    }
    .footer a { color: #fff; }
  </style>
</head>
<body>
  <div class="results-container">
    <div class="title">Quiz Results</div>

    <div class="tabs">
      <button class="tab-button active" onclick="openTab('summary')">Summary</button>
      <button class="tab-button" onclick="openTab('words')">Words</button>
    </div>

    <div id="summary-tab" class="tab-content active">
      <div class="summary">
        <div class="score" id="score">Score: 0 out of 0</div>
        <div class="percentage" id="percentage">0%</div>
      </div>
    </div>

    <div id="words-tab" class="tab-content">
      <div class="word-list" id="wordList"></div>
    </div>

    <div class="buttons">
      <button onclick="restartQuiz()">Restart Quiz</button>
      <button onclick="goBack()">Back to Dashboard</button>
    </div>
  </div>

  <div class="footer">
    <div>Contact Support: <a href="mailto:support@scaffwording.app">support@scaffwording.app</a></div>
    <div>©2024 Scaffwording. All Rights Reserved</div>
  </div>

  <script>
    // ----- Tabs -----
    function openTab(which) {
      document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      const btn = Array.from(document.querySelectorAll('.tab-button'))
        .find(b => b.textContent.toLowerCase().includes(which));
      if (btn) btn.classList.add('active');
      document.getElementById(`${which}-tab`).classList.add('active');
    }

    // ----- Data helpers -----
    function getSelectedIds() {
      const saved = localStorage.getItem('selectedWordIds');
      if (saved) {
        try {
          const arr = JSON.parse(saved).map(Number).filter(Number.isInteger);
          if (arr.length) return arr;
        } catch {}
      }
      const n = Number(localStorage.getItem('maxQuestions')) || 5;
      return Array.from({length: n}, (_, i) => i + 1);
    }

   // ----- Main render -----
(async () => {
  // Load words db
  const WORDS = await fetch('words.json').then(r => r.json());

  // Pull selection + shuffle
  const selectedIds = JSON.parse(localStorage.getItem('selectedWordIds') || '[]');
  const order = JSON.parse(localStorage.getItem('shuffledWordIds') || 'null');
  const ORDER = Array.isArray(order) && order.length ? order
                : (Array.isArray(selectedIds) && selectedIds.length ? selectedIds : []);

  // Score / stats
  const totalWords = Number(localStorage.getItem('maxQuestions')) || ORDER.length || 5;
  const rawScore   = Number(localStorage.getItem('quizScore') || '0');
  const score      = Math.min(rawScore, totalWords);

  // “incorrectWords” may be stored as indexes (0..n-1) or as wordIds — support both.
  const inc = new Set(JSON.parse(localStorage.getItem('incorrectWords') || '[]'));
  const incLooksLikeIndexes =
    [...inc].every(x => Number.isInteger(x) && x >= 0 && x < ORDER.length);

  // Render summary
  document.getElementById('score').textContent = `Score: ${score} out of ${totalWords}`;
  const pct = totalWords > 0 ? ((score / totalWords) * 100).toFixed(1) : '0.0';
  document.getElementById('percentage').textContent = `${pct}%`;

  // Render word list in the SAME order the user saw them
  const list = document.getElementById('wordList');
  list.innerHTML = '';

  const count = Math.min(totalWords, ORDER.length);
  for (let i = 0; i < count; i++) {
    const wordId = Number(ORDER[i]);
    const entry  = WORDS[String(wordId)] || {};
    const word   = entry.word || `Word ${wordId}`;

    const incorrect = incLooksLikeIndexes ? inc.has(i) : inc.has(wordId);
    const row = document.createElement('div');
    row.className = 'word-item';
    row.innerHTML = `
      <span class="word">${word}</span>
      <span class="status ${incorrect ? 'incorrect' : 'correct'}">
        ${incorrect ? 'Incorrect' : 'Correct'}
      </span>`;
    list.appendChild(row);
  }

  // Do NOT overwrite learnedWords here; it’s built live during the quiz.
})();


   

    // ----- Actions -----
    function restartQuiz() {
      localStorage.setItem('quizScore', '0');
      localStorage.setItem('incorrectWords', JSON.stringify([]));
      window.location.href = 'learn-quiz.html?index=0';
    }
    function goBack() { window.location.href = 'welcome.html?index=0'; }
  </script>
</body>
</html>
