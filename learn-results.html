<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scaffwording - Learn Results</title>
  <style>
    body{font-family:Arial,sans-serif;margin:0;padding:0;background:#4a4a4a;display:flex;justify-content:center;align-items:center;height:100vh}
    .results-container{background:#fff;padding:20px;border-radius:10px;text-align:center;width:320px;box-shadow:0 0 10px rgba(0,0,0,.4)}
    .title{color:#1a73e8;font-size:1.5em;margin-bottom:20px}
    .score{color:#000;font-size:1.2em;margin-bottom:20px}
    .word-list{text-align:left;margin-bottom:20px}
    .word-item{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #eee}
    .status.correct{color:#34a853}
    .status.incorrect{color:#ea4335}
    .buttons{margin-top:10px}
    .buttons button{background:#1a73e8;color:#fff;border:none;border-radius:5px;padding:10px 18px;cursor:pointer;margin:5px}
    .buttons button:hover{background:#1557a0}
    .footer{margin-top:40px;color:#ccc;font-size:.8em;text-align:center}
    /* === Beautiful XP Bar === */
        .xp-progress{
            height:10px;
            background:#e0e0e0;
            border-radius:6px;
            overflow:hidden;
            margin-top:2px;
            box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .xp-fill{
            height:100%;
            background:linear-gradient(to right,#34a853,#5dd46c);
            width:0%;
            border-radius:6px;
            transition:width 0.8s ease-out;
            box-shadow:0 2px 4px rgba(52,168,83,0.3);
        }
  </style>
</head>
<body>
  <div class="results-container">
    <div class="xp-bar" id="xpDisplay" style="margin: 20px 0; font-weight: bold; color: #1a73e8; display: inline-block;">
        Loading XP...
        </div>
    <div class="title">Quiz Results</div>
    <div class="score" id="score">Score: 0 out of 0</div>
    <div class="word-list" id="wordList"></div>
    <div class="buttons">
      <button onclick="restartQuiz()">Restart Quiz</button>
      <button onclick="goBack()">Back to Dashboard</button>
    </div>
  </div>
  <div class="footer">
    <div>Contact Support: <a href="mailto:support@scaffwording.app">support@scaffwording.app</a></div>
    <div>Â©2024 Scaffwording. All Rights Reserved</div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const SELECTED = JSON.parse(localStorage.getItem('selectedWordIds') || '[]');
      const maxQuestions = Number(localStorage.getItem('maxQuestions')) || SELECTED.length || 5;
      const score = Math.min(Number(localStorage.getItem('quizScore') || '0'), maxQuestions);
      const incorrectWords = new Set(JSON.parse(localStorage.getItem('incorrectWords')) || []);
      const WORDS = await fetch('words.json').then(r => r.json()).catch(()=>({}));

      // Update score
      document.getElementById('score').textContent = `Score: ${score} out of ${maxQuestions}`;

      // Populate word list
      const list = document.getElementById('wordList');
      list.innerHTML = '';
      const learned = [];
      const count = Math.min(maxQuestions, SELECTED.length);

      for (let i = 0; i < count; i++) {
        const id = Number(SELECTED[i]);
        const entry = WORDS[String(id)] || {};
        const word = entry.word || `Word ${id}`;
        const isCorrect = !incorrectWords.has(i);
        if (isCorrect) learned.push(word);

        const div = document.createElement('div');
        div.className = 'word-item';
        div.innerHTML = `
          <span>${word}</span>
          <span class="status ${isCorrect ? 'correct' : 'incorrect'}">
            ${isCorrect ? 'Correct' : 'Incorrect'}
          </span>`;
        list.appendChild(div);
      }

      // Save learned words

    });

    function restartQuiz() {
      localStorage.setItem('quizScore', '0');
      localStorage.setItem('incorrectWords', JSON.stringify([]));
      window.location.href = 'learn-quiz.html?index=0';
    }

    function goBack() {
      window.location.href = 'welcome.html';
    }
  </script>
  <script src="xp.js"></script>
  <script>
window.addEventListener('load', () => {
    const xpContainer = document.getElementById('xpDisplay');

    // 1. Let xp.js write the level + XP text
    renderXP('xpDisplay');

    // 2. Now inject the beautiful progress bar (it won't be overwritten anymore)
    if (!document.querySelector('.xp-progress')) {
        xpContainer.insertAdjacentHTML('beforeend', `
            <div class="xp-progress">
                <div class="xp-fill"></div>
            </div>
        `);
    }

    // 3. Finally fill the green bar
    if (typeof getXP === 'function' && typeof XP_PER_LEVEL === 'number') {
        const progress = (getXP() % XP_PER_LEVEL) / XP_PER_LEVEL * 100;
        const fill = document.querySelector('.xp-fill');
        if (fill) fill.style.width = progress + '%';
    }
});
</script>
</body>
</html>
